import{t as d,a as r,b as A,c as re}from"../chunks/BUVNq0sh.js";import{p as $e,s as T,a as te,b as be,f as O,c as t,g as e,l as g,k as w,m as C,Y as B,r as b,t as K}from"../chunks/DVbtH7dG.js";import{s as Q}from"../chunks/CH7mA5_C.js";import{i as F}from"../chunks/cO9CbSUo.js";import{a as G,b as V,e as oe,h as xe}from"../chunks/uO1cxeyq.js";import{b as Ee}from"../chunks/V2177jkn.js";import{o as ye}from"../chunks/dt_UomYr.js";import"../chunks/BoQ5mhZH.js";import{B as R}from"../chunks/UBRK0isu.js";import"../chunks/B82cbttc.js";import{D as Te}from"../chunks/8c6Qml3u.js";import{T as J}from"../chunks/Cq4lW-hV.js";import{S as De}from"../chunks/Cs43HK1c.js";import{T as Ne}from"../chunks/CXopf_pT.js";import{T as ke}from"../chunks/wfcOfcQ7.js";var Me=d("<div> </div>"),Ae=d("<!> <!> <!> <!> <!>",1),we=d('<div slot="title"> </div>'),Ce=d('<div slot="actions"><!> <!></div>'),Re=d('<td class="flex max-w-fit"><!> <!></td>'),Ie=d("<td> </td>"),Ue=d('<tr class="tabular-nums"></tr>'),ze=d('<tbody slot="data"></tbody>'),Se=d("<!> <!> <!>",1),Oe=d('<iframe title="scalar" id="scalar" src="https://localhost:7149/scalar" width="100%" height="100%"></iframe>'),Be=d('<div class="size-full p-2"><!></div>'),Fe=d("<!> <!>",1);function ra(le,se){$e(se,!0);let ie=[{label:"Utilisateurs",value:"users"},{label:"Scalar",value:"scalar"},{label:"Outils",value:"tools"}],I=T("users"),W=T(null),X=T(te([]));ye(L);async function L(){const{data:s,error:m}=await G().GET("/admin/utilisateur",{params:{header:{Authorization:V()}}});if(m){console.error("Error fetching data: ",m);return}s&&t(X,s.map(h=>({Id:h.id,Nom:h.nom,Prenom:h.prenom,Email:h.email,MotDePasse:h.motDePasse,Role:h.roleUtilisateur,Actions:""})),!0)}let a=T(te({Id:-1,Nom:"",Prenom:"",Email:"",MotDePasse:"",Role:"None"})),_=T(!1),i=T("create"),ne=[{label:"Aucun",value:"None"},{label:"Admin",value:"Admin"},{label:"Chef",value:"Chef"},{label:"Partenaire",value:"Partenaire"},{label:"Ouvrier",value:"Ouvrier"}],Y=T(!1);async function ue(){if(e(i)=="create"||e(i)=="update"){if(!e(a).Nom||!e(a).Prenom||!e(a).Email||!e(a).MotDePasse||!e(a).Role){alert("Veuillez remplir tous les champs");return}if(e(i)=="create"){t(Y,!0);const{data:s,error:m}=await G().POST("/admin/utilisateur/create",{params:{header:{Authorization:V()}},body:{nom:e(a).Nom,prenom:e(a).Prenom,email:e(a).Email,motDePasse:e(a).MotDePasse,roleUtilisateur:e(a).Role}});if(m){console.error("Error creating user: ",m),alert("Erreur lors de la création de l'utilisateur: "+m);return}s&&(await L(),t(Y,!1),t(_,!1))}else if(e(i)=="update"){const{data:s,error:m}=await G().PUT("/admin/utilisateur/{id}",{params:{header:{Authorization:V()},path:{id:e(a).Id}},body:{id:e(a).Id,nom:e(a).Nom,prenom:e(a).Prenom,email:e(a).Email,motDePasse:e(a).MotDePasse,roleUtilisateur:e(a).Role}});if(m){console.error("Error updating user: ",m),alert("Erreur lors de la mise à jour de l'utilisateur: "+m);return}s&&(await L(),t(Y,!1),t(_,!1))}}else if(e(i)=="delete"){const{response:s}=await G().DELETE("/admin/utilisateur/{id}",{params:{header:{Authorization:V()},path:{id:e(a).Id}}});console.log("Deleting user: ",s),s.status==200?(await L(),t(_,!1)):alert("Erreur lors de la suppression de l'utilisateur: "+s.statusText)}}ke(le,{options:ie,classes:{content:"h-[calc(100vh-84px)]"},get value(){return e(I)},set value(s){t(I,s,!0)},$$slots:{content:(s,m)=>{var h=Fe(),Z=O(h);{var de=c=>{var P=Se(),D=O(P);Te(D,{persistent:!0,get open(){return e(_)},set open(l){t(_,l,!0)},children:(l,E)=>{var o=re(),$=O(o);{var U=n=>{var u=Me(),p=w(u);b(u),K(()=>Q(p,`Êtes-vous sûr de vouloir supprimer l'utilisateur ${e(a).Prenom+" "+e(a).Nom} ?`)),r(n,u)},z=n=>{var u=Ae(),p=O(u);J(p,{label:"Prénom",get value(){return e(a).Prenom},set value(f){e(a).Prenom=f}});var N=g(p,2);J(N,{label:"Nom",get value(){return e(a).Nom},set value(f){e(a).Nom=f}});var k=g(N,2);J(k,{label:"Email",get value(){return e(a).Email},set value(f){e(a).Email=f}});var S=g(k,2);J(S,{label:"Mot de passe",type:"password",get value(){return e(a).MotDePasse},set value(f){e(a).MotDePasse=f}});var ee=g(S,2);De(ee,{label:"Rôle",options:ne,get value(){return e(a).Role},set value(f){e(a).Role=f}}),r(n,u)};F($,n=>{e(i)=="delete"?n(U):n(z,!1)})}r(l,o)},$$slots:{default:!0,title:(l,E)=>{var o=we(),$=w(o,!0);b(o),K(()=>Q($,e(i)=="create"?"Créer un utilisateur":e(i)=="update"?"Modifier un utilisateur":"Supprimer un utilisateur")),r(l,o)},actions:(l,E)=>{var o=Ce(),$=w(o);R($,{variant:"fill",color:"secondary",onclick:()=>{t(_,!1)},children:(n,u)=>{C();var p=A("Annuler");r(n,p)},$$slots:{default:!0}});var U=g($,2);const z=B(()=>e(i)=="delete"?"danger":"primary");R(U,{variant:"fill",get color(){return e(z)},onclick:ue,children:(n,u)=>{C();var p=A("Confirmer");r(n,p)},$$slots:{default:!0}}),b(o),r(l,o)}}});var v=g(D,2);R(v,{class:"my-2 ml-2",variant:"fill-light",color:"primary",onclick:()=>{t(_,!0),t(a,{Id:-1,Nom:"",Prenom:"",Email:"",MotDePasse:"",Role:"None"},!0),t(i,"create")},children:(l,E)=>{C();var o=A("Créer un utilisateur");r(l,o)},$$slots:{default:!0}});var x=g(v,2);Ne(x,{get data(){return e(X)},columns:[{name:"Id"},{name:"Nom"},{name:"Prenom"},{name:"Email"},{name:"MotDePasse"},{name:"Role"},{name:"Actions"}],$$slots:{data:(l,E)=>{var o=ze();const $=B(()=>E.columns),U=B(()=>E.data),z=B(()=>E.getCellValue);oe(o,21,()=>e(U)??[],xe,(n,u,p)=>{var N=Ue();oe(N,21,()=>e($),k=>k.name,(k,S,ee,f)=>{var ae=re();const pe=B(()=>e(z)(e(S),e(u),p));var fe=O(ae);{var _e=M=>{var y=Re(),j=w(y);R(j,{variant:"fill",color:"secondary",onclick:()=>{t(a,e(u),!0),t(i,"update"),t(_,!0)},children:(q,Pe)=>{C();var H=A("Modifier");r(q,H)},$$slots:{default:!0}});var ge=g(j,2);R(ge,{variant:"fill",color:"danger",onclick:()=>{t(a,e(u),!0),t(i,"delete"),t(_,!0)},children:(q,Pe)=>{C();var H=A("Suprimmer");r(q,H)},$$slots:{default:!0}}),b(y),r(M,y)},he=M=>{var y=Ie(),j=w(y,!0);b(y),K(()=>Q(j,e(pe))),r(M,y)};F(fe,M=>{e(S).name=="Actions"?M(_e):M(he,!1)})}r(k,ae)}),b(N),r(n,N)}),b(o),r(l,o)}}}),r(c,P)},me=(c,P)=>{{var D=v=>{var x=Oe();Ee(x,l=>t(W,l),()=>e(W)),r(v,x)};F(c,v=>{e(I)=="scalar"&&v(D)},P)}};F(Z,c=>{e(I)=="users"?c(de):c(me,!1)})}var ve=g(Z,2);{var ce=c=>{var P=Be(),D=w(P);R(D,{variant:"fill-light",color:"secondary",onclick:()=>{const v=V().split(" ")[1];if(!v){console.error("Bearer token not found");return}navigator.clipboard.writeText(v).then(()=>{alert("Token copié dans le presse-papier")}).catch(x=>{console.error("Failed to copy: ",x)})},children:(v,x)=>{C();var l=A("Copier le token Jwt 🗒️");r(v,l)},$$slots:{default:!0}}),b(P),r(c,P)};F(ve,c=>{e(I)=="tools"&&c(ce)})}r(s,h)}}}),be()}export{ra as component};
