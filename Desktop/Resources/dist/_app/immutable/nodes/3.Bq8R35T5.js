import{t as g,a as u,b as x}from"../chunks/BUVNq0sh.js";import{p as ce,s as d,a as V,b as pe,k as q,g as e,l as n,r as H,f as L,c as r,m as D}from"../chunks/DVbtH7dG.js";import{i as k}from"../chunks/cO9CbSUo.js";import"../chunks/BoQ5mhZH.js";import{P as fe,B as z}from"../chunks/UBRK0isu.js";import"../chunks/B82cbttc.js";import{O as ve,D as me}from"../chunks/8c6Qml3u.js";import{C as J}from"../chunks/pvuc6SZ4.js";import{T as E,I as ge}from"../chunks/Cq4lW-hV.js";import{S as K}from"../chunks/Cs43HK1c.js";import{g as T,l as $e,a as Q,b as U,s as he,f as be}from"../chunks/uO1cxeyq.js";import{g as _e}from"../chunks/L56fx7Z6.js";var ye=g("<!> <!> <!>",1),we=g("<!> <!> <!> <!> <!>",1),Ce=g('<div slot="title">Créer un nouveau chantier</div>'),Se=g('<!> <div class="flex flex-row"><!> <!></div> <!>',1),Pe=g('<div class="h-[calc(100vh-64px)] flex justify-center items-center"><!> <!></div>');function Fe(W,X){var M;ce(X,!0);let $=d(""),h=d(""),c=d(!1),A=d(0);async function Y(){if(!e($)||!e(h)){alert("Please fill in all fields");return}r(c,!0);var t=await $e(e($),e(h));t?(await Z(),r(A,1)):(alert("Login failed"),r(c,!1))}let O=d(V([])),I=d(V([])),b=d(null);async function Z(){const{data:t,error:s}=await Q().GET("/app/projects",{params:{header:{Authorization:U()}}});if(s){console.error(s),r(c,!1);return}t&&(r(O,t,!0),r(I,e(O).map(v=>({label:v.nom,value:v})),!0)),r(c,!1)}let _=d(!1),a=d(V({nom:"",details:"",dateDebut:new Date().toISOString(),status:"EnAttente",membres:[(M=T())==null?void 0:M.id]}));async function ee(){if(!e(a).nom){alert("Veuillez entrer un nom pour le chantier");return}if(!e(a).details){alert("Veuillez entrer des détails pour le chantier");return}if(!e(a).dateDebut){alert("Veuillez entrer une date de début pour le chantier");return}r(c,!0);const{data:t,error:s}=await Q().POST("/app/projects/create",{params:{header:{Authorization:U()}},body:e(a),bodySerializer:be});if(s){console.error(s),r(c,!1);return}t&&(e(O).push(t),e(I).push({label:t.nom,value:t}),r(_,!1)),r(c,!1)}function te(){var t;r(a,{nom:"",details:"",dateDebut:new Date().toISOString(),status:"EnAttente",membres:[(t=T())==null?void 0:t.id]},!0)}var j=Pe(),F=q(j);{var re=t=>{ve(t,{center:!0,children:(s,v)=>{fe(s,{})},$$slots:{default:!0}})};k(F,t=>{e(c)&&t(re)})}var ae=n(F,2);{var le=t=>{J(t,{class:"p-4 gap-2 w-96",title:"Se connecter",children:(s,v)=>{var m=ye(),y=L(m);E(y,{label:"Identifiant",get value(){return e($)},set value(p){r($,p,!0)}});var B=n(y,2);E(B,{type:"password",label:"Mot de passe",get value(){return e(h)},set value(p){r(h,p,!0)}});var w=n(B,2);z(w,{variant:"fill",color:"primary",type:"submit",class:"w-full",onclick:Y,children:(p,C)=>{D();var S=x("Se connecter");u(p,S)},$$slots:{default:!0}}),u(s,m)},$$slots:{default:!0}})},se=(t,s)=>{{var v=m=>{J(m,{class:"p-4 gap-2 w-96",title:"Selectionner un chantier",children:(y,B)=>{var w=Se(),p=L(w);me(p,{get open(){return e(_)},set open(l){r(_,l,!0)},children:(l,f)=>{var o=we(),P=L(o);E(P,{label:"Nom",get value(){return e(a).nom},set value(i){e(a).nom=i}});var N=n(P,2);E(N,{label:"Détails",get value(){return e(a).details},set value(i){e(a).details=i}});var R=n(N,2);ge(R,{type:"date",label:"Date de début",get value(){return e(a).dateDebut},set value(i){e(a).dateDebut=i}});var G=n(R,2);K(G,{label:"Statut",options:[{label:"En attente",value:"EnAttente"},{label:"En cours",value:"EnCours"},{label:"Terminé",value:"Termine"}],get value(){return e(a).status},set value(i){e(a).status=i}});var ue=n(G,2);z(ue,{variant:"fill",color:"primary",class:"mt-2",onclick:ee,children:(i,xe)=>{D();var de=x("Créer");u(i,de)},$$slots:{default:!0}}),u(l,o)},$$slots:{default:!0,title:(l,f)=>{var o=Ce();u(l,o)}}});var C=n(p,2),S=q(C);K(S,{get options(){return e(I)},label:"Chantier",get value(){return e(b)},set value(l){r(b,l,!0)}});var oe=n(S,2);{var ne=l=>{z(l,{variant:"fill",color:"primary",class:"ml-2",onclick:()=>{r(_,!0),te()},children:(f,o)=>{D();var P=x("Créer");u(f,P)},$$slots:{default:!0}})};k(oe,l=>{var f,o;(((f=T())==null?void 0:f.userRole)=="Admin"||((o=T())==null?void 0:o.userRole)=="Chef")&&l(ne)})}H(C);var ie=n(C,2);z(ie,{variant:"fill",color:"primary",type:"submit",class:"w-full",onclick:async()=>{e(b)&&(he(e(b).id),_e("/app"))},children:(l,f)=>{D();var o=x("Se connecter");u(l,o)},$$slots:{default:!0}}),u(y,w)},$$slots:{default:!0}})};k(t,m=>{e(A)==1&&m(v)},s)}};k(ae,t=>{e(A)==0?t(le):t(se,!1)})}H(j),u(W,j),pe()}export{Fe as component};
