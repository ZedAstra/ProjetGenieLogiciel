import{t as u,a,c as W,b as M}from"../chunks/BUVNq0sh.js";import{p as me,s as w,a as X,f as g,b as _e,c as i,g as n,l as s,k as h,r as m,m as N,t as ge}from"../chunks/DVbtH7dG.js";import{d as he,s as F}from"../chunks/CH7mA5_C.js";import{i as C}from"../chunks/cO9CbSUo.js";import{g as $e,a as Y,c as Z,b as ee,e as xe,h as be,f as we}from"../chunks/uO1cxeyq.js";import{h as Pe}from"../chunks/BZWbwrXd.js";import{o as ye}from"../chunks/dt_UomYr.js";import"../chunks/BoQ5mhZH.js";import{P as De,B as G}from"../chunks/UBRK0isu.js";import"../chunks/B82cbttc.js";import{O as Te,D as te}from"../chunks/8c6Qml3u.js";import{C as Se}from"../chunks/pvuc6SZ4.js";import{T as V,I as ke}from"../chunks/Cq4lW-hV.js";import{T as Ae}from"../chunks/wfcOfcQ7.js";var Ce=u('<div class="flex flex-col gap-2"><!> <!> <!> <!></div> <!>',1),Ie=u('<div slot="title">Publier</div>'),Oe=u('<div slot="actions"><!></div>'),Le=u("<!> <!>",1),ze=(j,I,P,$)=>{i(I,n(P),!0),i($,!0)},Be=u('<button class="p-4 bg-gray-100 rounded-md cursor-pointer"><h2 class="text-xl font-semibold"> </h2> <p> </p> <p> </p></button>'),Re=u('<!> <div class="flex flex-col gap-2"></div>',1),Ee=u("<p>Aucune annonce disponible.</p>"),Me=u('<!> <div class="flex flex-col gap-2"><h1 class="text-2xl font-bold">Annonces</h1> <!></div>',1),Ne=u("<!> <!>",1);function tt(j,I){me(I,!0);let P=$e(),$=w(X([])),O=w(!1);ye(async()=>re());async function re(){i(O,!0);const{data:o,error:v}=await Y().GET("/chantier/{chantierId}/communication/news",{params:{header:{Authorization:ee()},path:{chantierId:Z()}}});if(v){console.error(v);return}o&&i($,o.sort((y,B)=>new Date(B.date).getTime()-new Date(y.date).getTime()),!0),i(O,!1)}let ae=[{label:"Annonces",value:"annonces"}],L=w("annonces"),e=X({titre:"",description:"",date:new Date().toLocaleString(),content:""}),S=w(!1);function oe(){i(S,!0),e.titre="",e.description="",e.date=new Date().toLocaleString(),e.content=""}async function ne(){const{data:o,error:v}=await Y().POST("/chantier/{chantierId}/communication/news/create",{params:{header:{Authorization:ee()},path:{chantierId:Z()}},body:{titre:e.titre,description:e.description,date:new Date(e.date).toISOString(),content:e.content},bodySerializer:we});if(v){console.error(v);return}o&&(n($).push(o),e.titre="",e.description="",e.date=new Date().toLocaleString(),e.content=""),i(S,!1)}let z=w(!1),q=w(null);var H=Ne(),J=g(H);{var se=o=>{Te(o,{center:!0,children:(v,y)=>{De(v,{})},$$slots:{default:!0}})};C(J,o=>{n(O)&&o(se)})}var le=s(J,2);Ae(le,{options:ae,classes:{content:"p-2"},get value(){return n(L)},set value(o){i(L,o,!0)},$$slots:{content:(o,v)=>{var y=W(),B=g(y);{var ie=R=>{var K=Me(),Q=g(K);{var ce=l=>{var _=Le(),D=g(_);G(D,{variant:"fill-outline",color:"success",onclick:oe,children:(r,c)=>{N();var t=M("Publier une annonce");a(r,t)},$$slots:{default:!0}});var k=s(D,2);te(k,{classes:{dialog:"p-2 w-[calc(100wh-64px)]"},get open(){return n(S)},set open(r){i(S,r,!0)},children:(r,c)=>{Se(r,{class:"w-[calc(100vw-64px)]",children:(t,p)=>{var x=Ce(),f=g(x),b=h(f);V(b,{label:"Titre",get value(){return e.titre},set value(d){e.titre=d}});var T=s(b,2);V(T,{label:"Description",get value(){return e.description},set value(d){e.description=d}});var A=s(T,2);ke(A,{label:"Date et heure",type:"datetime-local",get value(){return e.date},set value(d){e.date=d}});var E=s(A,2);V(E,{label:"Contenu",get value(){return e.content},set value(d){e.content=d}}),m(f);var pe=s(f,2);G(pe,{variant:"fill",color:"primary",onclick:ne,children:(d,Fe)=>{N();var fe=M("Publier");a(d,fe)},$$slots:{default:!0}}),a(t,x)},$$slots:{default:!0}})},$$slots:{default:!0,title:(r,c)=>{var t=Ie();a(r,t)},actions:(r,c)=>{var t=Oe(),p=h(t);G(p,{variant:"fill",color:"danger",class:"w-full",children:(x,f)=>{N();var b=M("Annuler");a(x,b)},$$slots:{default:!0}}),m(t),a(r,t)}}}),a(l,_)};C(Q,l=>{(P.userRole=="Admin"||P.userRole=="Chef"||P.userRole=="Partenaire")&&l(ce)})}var U=s(Q,2),de=s(h(U),2);{var ue=l=>{var _=Re(),D=g(_);te(D,{classes:{dialog:"p-2 w-[calc(100wh-64px)]"},get open(){return n(z)},set open(r){i(z,r,!0)},children:(r,c)=>{var t=W(),p=g(t);Pe(p,()=>n(q).contenu),a(r,t)},$$slots:{default:!0}});var k=s(D,2);xe(k,21,()=>n($),be,(r,c)=>{var t=Be();t.__click=[ze,q,c,z];var p=h(t),x=h(p,!0);m(p);var f=s(p,2),b=h(f,!0);m(f);var T=s(f,2),A=h(T,!0);m(T),m(t),ge(E=>{F(x,n(c).titre),F(b,n(c).description),F(A,E)},[()=>new Date(n(c).date).toLocaleString()]),a(r,t)}),m(k),a(l,_)},ve=l=>{var _=Ee();a(l,_)};C(de,l=>{n($).length>0?l(ue):l(ve,!1)})}m(U),a(R,K)};C(B,R=>{n(L)=="annonces"&&R(ie)})}a(o,y)}}}),a(j,H),_e()}he(["click"]);export{tt as component};
